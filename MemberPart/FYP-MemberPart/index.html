<!DOCTYPE html>
<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script type="text/javascript" src="jquery-3.6.0.js"></script>
		<title>Layout</title>
		<link rel="stylesheet" type="text/css" href="css/960_12_col.css" />
		<link rel="stylesheet" href="./style.css">
		<!-- CSS only -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		<script src="https://cdn.tailwindcss.com"></script>
		<!-- <script src="main.js"></script> -->
		<script>
			function jwtDecode(token) {
				const tokens = token.split(".");
				const first = JSON.parse(atob(tokens[0])); 
				return {
					...JSON.parse(atob(tokens[0])),
					...JSON.parse(atob(tokens[1]))
				}
			}
			tailwind.config = {
				theme: {
					extend: {
						colors: {
							button_success: '#198754',
							button_fail: '#FF0000',
							clifford: '#da373d',
							button_info: '#2832C2',
						}
					}
				}
			}
		</script>
		
		<script>
			/* Set the width of the side navigation to 250px and the left margin of the page content to 250px */
			function openNav() {
				document.getElementById("mySidenav").style.width = "250px";
				if(document.getElementById('main')) {
					document.getElementById("main").style.marginLeft = "1px";
				}
			}

			/* Set the width of the side navigation to 0 and the left margin of the page content to 0 */
			function closeNav() {
				document.getElementById("mySidenav").style.width = "1px";
				if(document.getElementById('main')) {
					document.getElementById("main").style.marginLeft = "1px";
				}
			}
		</script>
		
	</head>
	<body>
		<div id="app"></div> <!-- Vue app mount point-->
		
		<!-- vue loader (Vue's compiler )-->
		<script src="https://cdn.jsdelivr.net/npm/vue3-sfc-loader/dist/vue3-sfc-loader.js"></script>
		<!-- Vue lib itself -->
		<script src="https://unpkg.com/vue@3"></script> 
		<!-- Vue router -->
		<script src="https://unpkg.com/vue-router@4.0.10/dist/vue-router.global.js"></script>

		<script>
			const jwtToken = localStorage.getItem('JWT_TOKEN');
			
			function isLogin() {
				return jwtToken !== null;
			}

			// Vue loader glude code
			const options = {
				moduleCache: {
					vue: Vue
				},
				async getFile(url) {
					
					const res = await fetch(url);
					if ( !res.ok )
					throw Object.assign(new Error(res.statusText + ' ' + url), { res });
					return {
						getContentData: asBinary => asBinary ? res.arrayBuffer() : res.text(),
					}
				},
				addStyle(textContent) {

					const style = Object.assign(document.createElement('style'), { textContent });
					const ref = document.head.getElementsByTagName('style')[0] || null;
					document.head.insertBefore(style, ref);
				},
			}
			
			const {loadModule} = window['vue3-sfc-loader'];
			const loadVue = (vuePath) => loadModule(vuePath, options);
			const loadVueFile = (vuePath) => () => loadVue(vuePath);

			// create a new Vuew app
			const app = Vue.createApp({

				// register a new components
				components: {
					'BaseLayout': Vue.defineAsyncComponent( () => loadModule('./components/layout.vue', options) ),
					'Header': Vue.defineAsyncComponent( () => loadModule('./components/Header.vue', options) ),
				},
				template: '<BaseLayout></BaseLayout>'
			});

			// defined a list of possible paths
			const routes = [
				{ 
					path: '/',
					component: loadVueFile('./pages/Home.vue'),
				},
				{ 
					path: '/home',
					component: loadVueFile('./pages/Home.vue'),
				},
				{
					path: '/auth/login',
					component: loadVueFile('./pages/Login.vue'),
				},
				{
					path: '/auth/register',
					component: loadVueFile('./pages/Register.vue'),
				},
				{ 
					path: '/account_information',
					component: loadVueFile('./pages/AccountInfo.vue'),
				},
				{ 
					path: '/change_password',
					component: loadVueFile('./pages/ChangePassword.vue'),
				},
				{ 
					path: '/notifications',
					component: loadVueFile('./pages/Notification.vue'),
				},
				{ 
					path: '/d_y_a',
					component: loadVueFile('./pages/DeleteAccount.vue'),
				},
				{ 
					path: '/achievement',
					component: loadVueFile('./pages/Achievement.vue'),
				},
				{ 
					path: '/language',
					component: loadVueFile('./pages/Language.vue'),
				},
			];

			const router = VueRouter.createRouter({
				// Tell vue router to use hash base navigation
				history: VueRouter.createWebHashHistory(),
				routes,
			});

			// register Vue router as a Vue plugin
			app.use(router);
			
			// check if the user is login or not
			if(!isLogin() && !window.location.hash.includes('/auth/register')) {
				// if not user NOT logged in, redirect to login page
				router.push('/auth/login');
			}
			
			// mount Vue app to mount point
			app.mount('#app');
		</script>

	</body>
</html>